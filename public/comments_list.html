<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>Comments List</title>
	<link type="text/css" rel="stylesheet" href="assets/css/styles.css">
	<link rel="stylesheet" href="comments.css">
</head>
<body>
	<div class="comments_list__overflow">
		<div class="top-choose">
			<div class="dropdown-comments-block">
				<div class="dropdown-comments-title">STATUS</div>
				<div class="dropdown-comments-menu comments-filter">
					<span class="dropdown-comments-top">All</span>
					<span class="dropdown-comments-toggle down fa"></span>
					<ul class="dropdown-comments-list hide">
						<li class="dropdown-comments-item">All</li>
						<li class="dropdown-comments-item">New</li>
						<li class="dropdown-comments-item">In progress</li>
						<li class="dropdown-comments-item">Corrected</li>
						<li class="dropdown-comments-item">Rejected</li>
						<li class="dropdown-comments-item">Forwarded</li>
					</ul>
				</div>
			</div>
			<div class="dropdown-comments-block">
				<div class="dropdown-comments-title">BOOK</div>
				<div class="dropdown-comments-menu comments-filter">
					<span class="dropdown-comments-top">Foundations of IT Service Management based on ITL</span>
					<span class="dropdown-comments-toggle down fa"></span>
					<ul class="dropdown-comments-list hide">
						<li class="dropdown-comments-item">All</li>
						<li class="dropdown-comments-item">Harry Potter and Philosopher's Stone</li>
						<li class="dropdown-comments-item">Kanban</li>
						<li class="dropdown-comments-item">Fight Club</li>
					</ul>
				</div>
			</div>
			<div class="dropdown-comments-block">
				<div class="dropdown-comments-title">EDITOR</div>
				<div class="dropdown-comments-menu comments-filter">
					<span class="dropdown-comments-top">All</span>
					<span class="dropdown-comments-toggle down fa"></span>
					<ul class="dropdown-comments-list hide">
						<li class="dropdown-comments-item">All</li>
						<li class="dropdown-comments-item">Шамиль</li>
						<li class="dropdown-comments-item">Алексей</li>
						<li class="dropdown-comments-item">Алеся</li>
					</ul>
				</div>
			</div>
			<div class="dropdown-comments-block">
				<div class="dropdown-comments-title">COMMENTATOR</div>
				<div class="dropdown-comments-menu comments-filter">
					<span class="dropdown-comments-top">All</span>
					<span class="dropdown-comments-toggle down fa"></span>
					<ul class="dropdown-comments-list hide">
						<li class="dropdown-comments-item">All</li>
						<li class="dropdown-comments-item">Шамиль</li>
						<li class="dropdown-comments-item">Алексей</li>
						<li class="dropdown-comments-item">Алеся Быконя</li>
					</ul>
				</div>
			</div>
		</div>

		<div class="comments-main">
			<table class="comments-main-table">
				<tr class="comments-main-trth">
					<th class="comments-main-th">DATE</th>
					<th class="comments-main-th">COMMENTATOR</th>
					<th class="comments-main-th">BOOK</th>
					<th class="comments-main-th">MARK</th>
					<th class="comments-main-th">EDITOR</th>
					<th class="comments-main-th">STATUS</th>
					<th class="comments-main-th">CORRECTOR</th>
				</tr>
				<tr class="comments-main-trtd">
					<td class="comments-main-td">17.11.2017</td>
					<td class="comments-main-td">Michel Salgado, student</td>
					<td class="comments-main-td"><a href="">Foundations of IT Service Management based on ITL</a></td>
					<td class="comments-main-td">142</td>
					<td class="comments-main-td">Иванов Иван, мл. редактор</td>
					<td class="comments-main-td comment-status">
						<span class="comment-status-current">New</span>
						<ul class="dropdown-comments-list hide">
							<li class="dropdown-comments-item status-item">In progress</li>
							<li class="dropdown-comments-item status-item">Corrected</li>
							<li class="dropdown-comments-item status-item">Rejected</li>
						</ul>
					</td>
					<td class="comments-main-td corrector">
						<span class="comment-corrector-current">Алеся Быконя</span>
						<ul class="dropdown-comments-list hide">
							<li class="dropdown-comments-item corrector-item">Алеся Быконя</li>
							<li class="dropdown-comments-item corrector-item">Шамиль</li>
							<li class="dropdown-comments-item corrector-item">Алексей</li>
						</ul>
					</td>
				</tr>
				<tr class="comments-main-trtd">
					<td class="comments-main-tdcomment" colspan="7">
						<span class="collapse-comment fa js-comment-list" title="Hide"></span>
						<p></p>
					</td>
				</tr>
				<tr class="comments-main-trtd">
					<td class="comments-main-td">17.11.2017</td>
					<td class="comments-main-td">Michel Salgado, student</td>
					<td class="comments-main-td"><a href="">Foundations of IT Service Management based on ITL</a></td>
					<td class="comments-main-td">142</td>
					<td class="comments-main-td">Иванов Иван, мл. редактор</td>
					<td class="comments-main-td comment-status">
						<span class="comment-status-current">New</span>
						<ul class="dropdown-comments-list hide">
							<li class="dropdown-comments-item status-item">In progress</li>
							<li class="dropdown-comments-item status-item">Corrected</li>
							<li class="dropdown-comments-item status-item">Rejected</li>
						</ul>
					</td>
					<td class="comments-main-td corrector">
						<span class="comment-corrector-current">Алеся Быконя</span>
						<ul class="dropdown-comments-list hide">
							<li class="dropdown-comments-item corrector-item">Алеся Быконя</li>
							<li class="dropdown-comments-item corrector-item">Шамиль</li>
							<li class="dropdown-comments-item corrector-item">Алексей</li>
						</ul>
					</td>
				</tr>
				<tr class="comments-main-trtd">
					<td class="comments-main-tdcomment" colspan="7">
						<span class="collapse-comment fa js-comment-list" title="Hide"></span>
						<p></p>
					</td>
				</tr>
				<tr class="comments-main-trtd">
					<td class="comments-main-td">17.11.2017</td>
					<td class="comments-main-td">Michel Salgado, student</td>
					<td class="comments-main-td"><a href="">Foundations of IT Service Management based on ITL</a></td>
					<td class="comments-main-td">142</td>
					<td class="comments-main-td">Иванов Иван, мл. редактор</td>
					<td class="comments-main-td comment-status">
						<span class="comment-status-current">New</span>
						<ul class="dropdown-comments-list hide">
							<li class="dropdown-comments-item status-item">In progress</li>
							<li class="dropdown-comments-item status-item">Corrected</li>
							<li class="dropdown-comments-item status-item">Rejected</li>
						</ul>
					</td>
					<td class="comments-main-td corrector">
						<span class="comment-corrector-current">Алеся Быконя</span>
						<ul class="dropdown-comments-list hide">
							<li class="dropdown-comments-item corrector-item">Алеся Быконя</li>
							<li class="dropdown-comments-item corrector-item">Шамиль</li>
							<li class="dropdown-comments-item corrector-item">Алексей</li>
						</ul>
					</td>
				</tr>
				<tr class="comments-main-trtd">
					<td class="comments-main-tdcomment" colspan="7">
						<span class="collapse-comment fa js-comment-list" title="Show"></span>
						<p></p>
					</td>
				</tr>

			</table>
		</div>

	</div>

	<script src="assets/js/plugins/jquery-1.9.1.min.js"></script>
	<script>
		// Просто текущая дата
		function currentDate () {
			var date = new Date();
			var curDate = " (" + date.getDate() + "." + date.getMonth() + "." + date.getFullYear() + ")";
			return curDate;
		};

		// Заполняем комментарии из базы
		var commentsArray = [
				'Lorem ipsum dolor sit amet, consectetur adipisicing elit. Repudiandae natus id, dicta incidunt quidem sint assumenda perspiciatis suscipit necessitatibus deserunt, ad voluptas temporibus ipsum pariatur, cum distinctio esse tempore voluptate maiores magni odio! Minus sit nulla, officia natus optio et qui, id tempore doloribus maxime aut laudantium? Provident, quia, iste.',
				'Lorem ipsum dolor sit amet, consectetur adipisicing elit. Id commodi maxime, debitis ut maiores, laborum alias. Blanditiis, dolores quis. Impedit, aliquid possimus aut quos inventore sunt iste nam optio, rerum velit quo dolores minus voluptates expedita asperiores? Repudiandae voluptate animi hic explicabo porro, sequi iusto nostrum fugit cupiditate saepe quam libero, ut odit eveniet. Voluptatem nostrum molestias, officiis perspiciatis deserunt, rerum dicta in at atque. Ullam error libero molestiae eaque at itaque officiis magnam eligendi quidem, perferendis dicta id voluptas voluptatem asperiores voluptate sapiente repudiandae. Sunt magnam tenetur optio natus.',
				'Lorem ipsum dolor sit amet, consectetur adipisicing elit. Nobis possimus beatae doloribus eaque sunt eius maxime, ex similique architecto illum minus deleniti, provident tempora asperiores.'
			]; // Массив значений комментариев (в теории - из базы данных)
		var tagsArray = $('.comments-main-tdcomment p'); // Массив ячеек комментариев

		$(document).ready(function($) {
			for (var i = 0; i < commentsArray.length; i++) {
				if (commentsArray[i].length < 280) { // Длина несвернутой ячейки
					tagsArray.eq(i).text(commentsArray[i]);
					tagsArray.eq(i).parent().find('span').hide();
				} else {
					tagsArray.eq(i).text(commentsArray[i].slice(0, 280)+'...');
				};
			};
		});

		// Выбор верхнего фильтра
		$('.dropdown-comments-menu.comments-filter').click(function(event) {
			$(this).find('.dropdown-comments-list').toggleClass('hide');
		});
		$('.dropdown-comments-menu.comments-filter .dropdown-comments-item').click(function(event) {
			$(this).parent().find('.dropdown-comments-list').toggleClass('hide');
			$(this).parent().parent().find('.dropdown-comments-top').text($(this).text());
		});

		// Выбор статуса
		$('.comment-status-current').click(function(event) {
			$(this).siblings(0).removeClass('hide');
			$(this).siblings(0).find('.dropdown-comments-list').toggleClass('hide');
		});
		$('.dropdown-comments-list .status-item').click(function(event) {
			var curChoice = $(this).text();
			$(this).parent().addClass('hide');
			$(this).parent().parent().find('.comment-status-current').show().text(curChoice + currentDate());
		});

		// Выбор корректора
		$('.comment-corrector-current').click(function(event) {
			$(this).siblings(0).removeClass('hide');
			$(this).siblings(0).find('.dropdown-comments-list').toggleClass('hide');
			$(this).siblings(0).find('.dropdown-comments-top').text($(this).text());
		});
		$('.dropdown-comments-list .corrector-item').click(function(event) {
			var curChoice = $(this).text();
			$(this).parent().addClass('hide');
			var correctorName = $(this).parent().parent().find('.comment-corrector-current');
			correctorName.text(curChoice);
			// Проверка, открыто ли меню выбора статуса
			var ifStatusIsActiveNow = correctorName.parent().parent().find('.dropdown-comments-list');
			var currentStatus = correctorName.parent().parent().find('.comment-status-current');
			if (ifStatusIsActiveNow.hasClass('hide')) {
				ifStatusIsActiveNow.addClass('hide');
			};
			currentStatus.text('Forwarded'  + currentDate());
		});

		// Сворачиваем-разворачиваем длинные комменты
		$('.js-comment-list').click(function(event) {
			var numberOfComment = $(this).parent().parent().index() / 2; // Индекс строки таблицы для определения номера комментария в массиве
			$(this).toggleClass('expand-comment').toggleClass('collapse-comment');
			if ($(this).hasClass('expand-comment')) {
				$(this).attr({title: 'Hide'});
				$(this).parent().find('p').text(commentsArray[numberOfComment - 1]);
			} else {
				$(this).attr({title: 'Show'});
				$(this).parent().find('p').text(commentsArray[numberOfComment - 1].slice(0,280)+'...');
			};
		});

	</script>
</body>
</html>